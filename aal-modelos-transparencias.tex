% !TeX program = pdflatex
% !TeX encoding = UTF-8
% !TeX spellcheck = es_ES

\documentclass[9pt, handout]{beamer}

\input{conf/conf}

\title[AAL y modelos estocásticos]{Ambient Assisted Living y modelos estocásticos}
\author{\textbf{Tommaso Papini}}
\institute{
  STLab, Departamiento de la Ingenieria de la Informacíon, Universidad de Florencia, Italia,\\
  {tommaso.papini@unifi.it}
}
\date{
  29 de Mayo 2017\\
  {\small Departamento de Informática, Universidad de Jaén, España}
}

\begin{document}

  \begin{frame}
    \titlepage
    \begin{itemize}
      \item Ambient Assisted Living
      \item Modelos y datasets
      \item Análisis de entornos inteligentes
    \end{itemize}
  \end{frame}

  \begin{frame}{Overview}
    %\tiny
    \tableofcontents
  \end{frame}
  
  \section{Ambient Assisted Living}
    
    \begin{frame}{Ambient Assisted Living}
      El \textbf{Ambient Assisted Living} es un sector de investigación que tiene como objetivo lo de ayudar a las personas que viven en \textit{entornos inteligentes} (es decir, dotados de sensores y actuadores) explotando a la tecnología de sensores y de procesamiento de datos.
      
      \begin{center}
        \includegraphics[scale=1.8]{elderly_assi.jpg}
      \end{center}
    \end{frame}
    
    \subsection{Objetivos}
      \begin{frame}{Objetivos}
        \pause
        Un \textit{entorno inteligente} es un sistema \textbf{parcialmente observable}:
        \pause
        \begin{itemize}
          \item el estado efectivo del sistema resulta oculto;
          \pause
          \item solo se pueden observar eventos (\textit{observaciones}) emitidos por el sistema (por ej. la activación de un sensor).
        \end{itemize}
        
        \vspace{1em}
        \pause
        Principales análisis de interese:
        \pause
        \begin{itemize}
          \item \textbf{Diagnosis}: estimar cual es el estado efectivo actual del sistema a partir de las observaciones registradas.
          \pause
          \item \textbf{Predicción}: estimar cual será el estado efectivo del sistema después de una determinada cantidad de tiempo o la densidad de probabilidad de que un evento se verifique.
          \item \textbf{Planificación de acciones}: elegir la acción optima y entre cuanto tiempo ir actuarla para evitar situaciones críticas.
        \end{itemize}
        
        \vspace{1em}
        \pause
        Análisis en linea:
        \pause
        \begin{itemize}
          \item intenta analizar a un entorno inteligente \textit{mientras} está evolucionando.
        \end{itemize}
      \end{frame}
    
  \section{Modelos y datasets}
    \subsection{Modelos estocásticos}
      \begin{frame}{Modelos estocásticos}
        Los \textit{modelos estocásticos} representan una aproximación de sistemas donde se modelan:
        \begin{itemize}
          \item la evolución del estado del sistema;
          \item parámetros estocásticos que definen como el sistema pasa de un estado al otro.
        \end{itemize}
        \begin{center}
          \colorbox{white}{\includegraphics[scale=0.28]{708px-HMMGraph.png}}
        \end{center}
      \end{frame}
    
    \subsection{Datasets anotados}
      \begin{frame}{Datasets anotados}
        Un \textit{dataset anotado} es un dataset donde hay:
        \begin{itemize}
          \item los eventos registrados y cuando han pasado (marca temporal);
          \item anotaciones manuales de la evolución del estado efectivo del sistema (con intervalos temporales por cada estado).
        \end{itemize}
        Un ejemplo clásico de dataset anotado para AAL es el dataset de \textit{van Kasteren}\footnote{\url{https://sites.google.com/site/tim0306/datasets}}\footnote{Van Kasteren, T., Noulas, A., Englebienne, G. and Kröse, B., 2008, September. Accurate activity recognition in a home setting. In Proceedings of the 10th international conference on Ubiquitous computing (pp. 1-9). ACM.}\\[1em]
        
        \includegraphics[scale=0.8]{activity_event_formulation.pdf}
      \end{frame}
    
    \subsection{Process mining}
      \begin{frame}{Process mining}{De datasets anotados a modelos estocásticos}
        Con el término \textbf{process mining} se indica un conjunto de técnicas para construir a un modelo estocástico de un sistema parcialmente observable a partir de un dataset anotado de este mismo sistema.
        
        \vspace{1em}
        El process mining está compuesto por dos técnicas principales:
        \begin{itemize}
          \item \textbf{Process elicitation}: construye un modelo discreto (es decir, sin informaciones sobre la permanencia en los estados del sistema) a partir de los eventos y actividades anotados en el dataset.
          \item \textbf{Process ehnancement}: añade una visión temporal continua a un modelo discreto introduciendo parámetros estocásticos que describen como el sistema evoluciona a lo largo del tiempo utilizando medidas estadísticas sacadas por el dataset.
        \end{itemize}
      \end{frame}
    
  \section{Análisis de entornos inteligentes}
  
    \begin{frame}{Análisis de entornos inteligentes}{Esquema general}
      \vspace{-1em}
      \begin{center}
        \includegraphics[scale=0.34]{architecture.png}
      \end{center}
      
      \begin{itemize}
        \item \textbf{Process mining}: de dataset anotado a modelo estocásticos.
        \item \textbf{Diagnosis}: de eventos efectivos a probabilidad del estado corriente (sobre un determinado modelo estocástico).
        \item \textbf{Predicción}: de probabilidad del estado corriente a probabilidad de que ocurra un evento crítico.
        \item \textbf{Planificación}: de probabilidad de que ocurra un evento crítico a tiempo de planificación de una reacción (con una determinada política de reacción).
      \end{itemize}
    \end{frame}
  
    \subsection{Diagnosis}
      \begin{frame}{Diagnosis}{Tiempo discreto}
        Los \textbf{Modelos Ocultos de Márkov} (Hidden Markov Model, HMM):
        \begin{itemize}
          \item modelan a un sistema parcialmente observable sin tener en cuenta del tiempo de permanencia en cada estado;
          \item asocian a cada estado efectivo del sistema una distribución discreta sobre los eventos observables;
          \item modelan a un sistema donde los estados efectivos evolucionan como una \textit{Cadena de Márkov Tiempo Discreto} (Discrete Time Markov Chain, DTMC).
          
        \end{itemize}
        \begin{center}
          \includegraphics[scale=0.25]{HMM.png}
        \end{center}
        Diagnosis con HMM se puede lograr con algoritmos clásicos como el \textit{algoritmo de Viterbi} o el \textit{algoritmo de Forward-Backward}.
      \end{frame}
      
      \begin{frame}{Diagnosis}{Tiempo discreto con permanencia}
        \begin{itemize}
          \item \textbf{HSMM}\footnote{Van Kasteren, T.L.M., Englebienne, G. and Kröse, B.J., 2010. Activity recognition using semi-markov models on real world smart home datasets. Journal of ambient intelligence and smart environments, 2(3), pp.311-325.}
          \begin{itemize}
            \item Hidden Semi Markov Model;
            \item permanencia en los estados ocultos modelada con distribuciones te tiempo discreto;
            \item eventos generados en cada instante temporal.
          \end{itemize}
          \item \textbf{IS-HSMM}/\textbf{ILP-HSMM}\footnote{Narimatsu, H. and Kasai, H., 2016. State Duration and Interval Modeling in Hidden Semi-Markov Model for Sequential Data Analysis. arXiv preprint arXiv:1608.06954.}
          \begin{itemize}
            \item Interval State-Hidden Semi Markov Model;
            \item Interval Length Probability-Hidden Semi Markov Model;
            \item extensiones de los HSMMs;
            \item permite modelar a intervalos de silencio (es decir, sin eventos);
          \end{itemize}
        \end{itemize}
      \end{frame}
      
      \begin{frame}{Diagnosis}{Tiempo continuo}
        \begin{itemize}
          \item \textbf{HnMM}\footnote{Buchholz, R., Krull, C., Strigl, T. and Horton, G., 2010, March. Using hidden non-markovian models to reconstruct system behavior in partially-observable systems. In Proceedings of the 3rd International ICST Conference on Simulation Tools and Techniques (p. 86). ICST (Institute for Computer Sciences, Social-Informatics and Telecommunications Engineering).}
          \begin{itemize}
            \item Hidden nonMarkov Model;
            \item tiempos de permanencia continuos;
            \item cada \textit{transición} (es decir, el pasaje de un estado al siguiente) produce un evento.
          \end{itemize}
          \item \textbf{GHSMM}\footnote{Salfner, F., 2006. Modeling event-driven time series with generalized hidden semi-Markov models.}
          \begin{itemize}
            \item Generalized Hidden Semi Markov Process;
            \item tiempo de permanencia continuo;
            \item solo una observación por cada estado.
          \end{itemize}
        \end{itemize}
      \end{frame}
      
      \begin{frame}{Diagnosis}{H-MRGP-M}
        El \textbf{Modelo Oculto de Márkov Regenerativo} (Hidden-Markov Regenerative Process-Model) ha sido dessarollado por el STLab en la Universidad de Florencia.\footnote{Carnevali, L., Nugent, C., Patara, F. and Vicario, E., 2015, September. A continuous-time model-based approach to activity recognition for ambient assisted living. In International Conference on Quantitative Evaluation of Systems (pp. 38-53). Springer International Publishing.}
        
        \begin{itemize}
          \item Modela el tiempo continuo de permanencia en los estados y del inter-tiempo entre eventos.
          \item El estado del modelo evoluciona como un \textit{Proceso Regenerativo de Márkov} (Markov Regenerative Process, MRP).
        \end{itemize}
      \end{frame}
      
      \begin{frame}{Diagnosis}{H-MRGP-M: tiempos continuos}
        \begin{itemize}
          \item Experimentado sobre el dataset de van Kasteren:
          \begin{itemize}
            \item 7+1 actividades.
            \item \{Leaving house, Preparing a beverage, Preparing breakfast, Preparing dinner, Sleeping, Taking shower, Toileting\}.
          \end{itemize}
          \item A partir de las marcas temporales en el dataset anotado, se calculan medidas estadísticas sobre los tiempos continuos
          \begin{itemize}
            \item de permanencia en cada actividad;
            \item de inter-tiempo entre eventos en cada actividad.
          \end{itemize}
        \end{itemize}
        
    		\begin{table}[h!]
    			\centering
    			\small
    			\setlength{\tabcolsep}{5pt}
    			\def\arraystretch{0.75}
    			\begin{tabular}{| l | c | c || c | c |}
    				\hline
    				& \multicolumn{2}{|c||}{\bf Tiempo de permanencia}& \multicolumn{2}{|c|}{\bf Inter-tiempo entre eventos}\\
    				\cline{2-5}
    				& $\mu$ (s) & {\bf CV} & $\mu$ (s) & {\bf CV}\\
    				\hline
    				{\bf Leaving house} & 40\,261.455 & 1.042 & 9\,354.190 & 2.810 \\ \hline
    				{\bf Preparing a beverage} &  35.667 & 1.361 & 7.643 & 2.613\\ \hline
    				{\bf Preparing breakfast} &  108.684 & 0.713 & 9.928 & 1.844\\ \hline
    				{\bf Preparing dinner} &  1\,801.889 & 0.640 & 77.966 & 2.589\\ \hline
    				{\bf Sleeping} &  26\,116.571 & 0.442 & 1\,871.836 & 3.090\\ \hline
    				{\bf Taking shower} &  485.910 & 0.298 & 102.788 & 1.969\\ \hline
    				{\bf Toileting} &  88.742 & 1.175 & 14.814 & 2.449\\ 
    				\hline
      		\end{tabular}
    		\end{table}
      \end{frame}
      
      \begin{frame}{Diagnosis}{H-MRGP-M: modelo estocástico @runtime}
        \begin{itemize}
          \item El modelo se crea con técnicas de \textit{process mining}:
          \begin{itemize}
            \item \textit{process elicitation} para definir la topología del modelo;
            \item \textit{process enhancement} para añadir parámetros estocásticos a partir de las medidas estadísticas calculadas (estrategia de Whitt\footnote{Whitt, W., 1982. Approximating a point process by a renewal process, I: Two basic methods. Operations Research, 30(1), pp.125-147.} y software PhFit\footnote{Horváth, A. and Telek, M., 2002, April. Phfit: A general phase-type fitting tool. In International Conference on Modelling Techniques and Tools for Computer Performance Evaluation (pp. 82-91). Springer Berlin Heidelberg.}).
          \end{itemize}
          \item Modelo \textbf{@runtime}: modelo actualizado cada vez que se observa un nuevo evento.\footnote{Blair, G., Bencomo, N. and France, R.B., 2009. Models@ run. time. Computer, 42(10).}
          \item El formalismo utilizado para representar al modelo es el de las \textbf{Redes de Petri Temporizadas estocásticas} (stochastic Timed Petri Net, sTPN).\footnote{Horváth, A. and Vicario, E., 2009, September. Aggregated stochastic state classes in quantitative evaluation of non-markovian stochastic Petri nets. In Quantitative Evaluation of Systems, 2009. QEST'09. Sixth International Conference on the (pp. 155-164). IEEE.}\footnote{Vicario, E., 2001. Static analysis and dynamic steering of time-dependent systems. IEEE transactions on software engineering, 27(8), pp.728-748.}
        \end{itemize}
      \end{frame}
      
      \begin{frame}{Diagnosis}{H-MRGP-M: sTPN}
        \begin{center}
          \includegraphics[scale=0.32]{model_withGEN.pdf}
        \end{center}
      \end{frame}
      
      \begin{frame}{Diagnosis}{H-MRGP-M: probabilidades}
        Después de cada observación, se pueden calcular las probabilidades de ser en diferentes estados del sistema hasta la observación siguiente.
        \begin{itemize}
          \item Se explota a la técnica de análisis transitorio de Procesos Regenerativos de Markov basada en clases de estado estocásticas.\footnote{Horváth, A., Paolieri, M., Ridi, L. and Vicario, E., 2012. Transient analysis of non-Markovian models using stochastic state classes. Performance Evaluation, 69(7), pp.315-335.}
        \end{itemize}
        
        \begin{center}
          \includegraphics[scale=0.18]{diagnosis-analysis-scheme.png}
        \end{center}
        
        El estado estimado por la diagnosis será el estado que lleva la probabilidad más alta.
      \end{frame}
      
      \begin{frame}{Diagnosis}{H-MRGP-M: probabilidades}
        \begin{center}
          \includegraphics[scale=0.35]{onLineAnalysisAfterN-eps-converted-to.pdf}
        \end{center}
      \end{frame}
      
    \subsection{Predicción}
      \begin{frame}{Predicción\footnote{Salfner, F., Lenk, M. and Malek, M., 2010. A survey of online failure prediction methods. ACM Computing Surveys (CSUR), 42(3), p.10.}}
        Predicción de la densidad de probabilidad de una actividad crítico:
        \begin{itemize}
          \item Process enhancement sin elicitation:
          \begin{itemize}
            \item probabilidades de transición calculadas por las medidas estadísticas sobre las marcas temporales.
          \end{itemize}
          \item Estados \textit{idle} especializados:
          \begin{itemize}
            \item permite tener en cuenta la última actividad.
          \end{itemize}
          \item Las actividades evolucionan como un \textit{Proceso Semi Márkov} (Semi Markov Process, SMP).
        \end{itemize}
        
      	\begin{figure}[center]
      		\scalebox{0.7}{\input{img/smp.tex}}
      	\end{figure}
      \end{frame}
      
      \begin{frame}{Predicción}
      	\input{img/predictionAnalysis.tex}
      	\begin{itemize}
        	\item Para cada estado posible, se calcula la densidad de probabilidad de alcanzar al estado crítico (análisis transitorio).
        	\item Se suman entre sí las densidades de probabilidad a partir de cada estado posible, pesadas por la probabilidad de ser en cada estado.
      	\end{itemize}
      	\vspace{-1em}
      	\include{img/plotComposition}
      \end{frame}
      
    \subsection{Planificación de acciones}
      \begin{frame}{Planificación de acciones}{Descripción del problema}
        \begin{itemize}
          \item \textbf{Actividad crítica}: actividad por la cual nos interesa planificar una reacción.
          \item \textbf{Reacción}: acción que el sistema tiene que actuar cuando ocurre la actividad crítica.
          \item \textbf{Duración de la reacción}: duración $t_d$ del tiempo de activación de la reacción.
          \item \textbf{Tiempo de actuación de la reacción}: tiempo $t_w$ necesario al sistema para actuar a la reacción desde cuando ha sido planificada.
        \end{itemize}
        
      	\begin{columns}
      		\column{0.60\linewidth}
      		\centering
      		\include{img/schedulingParameters}
      		\column{0.40\linewidth}
      		Por ej. notificación para tomar píldoras antes de cenar:
      		\begin{itemize}
      			\item $t_w = 60s$
      			\item $t_d = 120s$
      			\item Notifica al instante $\tilde t$
      		\end{itemize}
      	\end{columns}
      \end{frame}
      
      \begin{frame}{Planificación de acciones}{Politica de planificación\footnote{Biagi, M., Carnevali, L., Paolieri, M., Patara, F. and Vicario, E., 2016, October. A Stochastic Model-Based Approach to Online Event Prediction and Response Scheduling. In European Workshop on Performance Engineering (pp. 32-47). Springer International Publishing.}}
        \begin{itemize}
          \item Se busca al \textbf{intervalo de mayor probabilidad} (de longitud $t_d$) de que ocurra la actividad crítica.
          \item Si la \textbf{probabilidad máxima} está mas alta de un \textbf{umbral fijo}, la reacción será planificada por el sistema al instante $\boldsymbol{\tilde t = x^* - t_w}$, donde $x^*$ indica el extremo inferior del intervalo de máxima probabilidad.
          \item Si la probabilidad máxima está mas baja del umbral, ninguna reacción será planificada por el sistema.
        \end{itemize}
        \vspace{-1em}
      	\centering
      	\include{img/schedulingExample}
      \end{frame}
      
  \section*{Fin}
    \begin{frame}
      \begin{center}
      	\textbf{\calligra\Huge Fin.}\\
        \includegraphics[width=5cm]{ornament.eps}\\[1cm]
      	\pause
      	{\huge\calligra Preguntas?\pause{} Gracias!}
      \end{center}
    \end{frame}
      
\end{document}
