% !TeX root = ../smc-report.tex
% !TeX encoding = UTF-8
% !TeX spellcheck = en_GB

\section*{LINFA: Smart drugs restocking}

  \subsection*{Smart drugs restocking}

    The pharmaceutical logistic chain is a very complex system, as it includes several actors and critical points (such as elevated drug costs, need for transport at monitored temperature, chance of expiration of goods, stock management, irregularity of demands, several possible logistic approaches, etc), which render the problem hard to optimize without the proper tools for decision support. In this context, possible unavailability could lead to critical situations, sometime even catastrophic, as it wouldn't be possible any more to guarantee the correct execution of one or more healthcare protocol, thus affecting the patients' health. Furthermore, orders are typically carried out on a daily basis and in a manual fashion, without the support of any decision support system. All these reasons makes restocking schedule hard, thus leading to unproductive stocks and higher stocking costs.
    
    In this scenario fits the project \textit{LINFA} (i.e. \textit{Logistica INtelligent del FArmaco}, or \textit{Smart Drug Logistic}, from Italian), that aims to develop an IT system for support to processes of drugs logistic management, in the context of healthcare or local companies. LINFA aims to increase efficiency, effectiveness and predictability of the process of drugs and medical devices restocking, within healthcare structures, through methods of predictive analysis and optimization, advanced logistic techniques and tracking features through the use of RFID technologies or the integration of healthcare and administrative information stream.
    
    For sake of simplicity, the following assumptions will be made in order to build a model:
    
    \begin{itemize}
      \item a single ward is present;
      \item the ward has a fixed number of beds (40) and a fixed maximum storage capacity (40);
      \item patients are indistinguishable;
      \item there is only one type of drug;
      \item patients can arrive through emergencies (i.e. according to a random variable) or scheduled examinations (i.e. according to a fixed constant);
      \item each day, patients can leave the ward with a certain probability;
      \item each day, patients can consume up to 3 units of drug;
      \item for each missing drug, an urgent order is issued, which arrives immediately;
      \item restock orders are issued at the end of each day and arrive immediately;
      \item the drug can be restocked in quantities of 0 (i.e. no order), 10, 20, 30 or 40.
    \end{itemize}
    
    The model in Code \ref{lst:ward} models a generic ward with the above specifications and 3 days of lookahead. The model is used to support decision to the restock order of the current day, so it starts at the end of the current day (i.e. after patients arrival/discharge and drug consumption, but before the restock order). The arrival of patients and the consumption of drugs have been modelled through custom distributions, while drug restock orders have been modelled through non-deterministic choices, effectively representing the user's choice.
    
    \begin{center}
      \lstinputlisting[language=prism, caption={PRISM code for the model of a hospital ward.}, label={lst:ward}]{code/ward.sm}
    \end{center}
    
    \question{Look at the model in Code \ref{lst:ward} and describe how it works.\\}
    \answer{
      The first thing that can be seen about the model is that it is defined as a Markov Decision Process (MDP). This is due the presence of non-deterministic choices at the end of each day, representing drug orders.
      
      In the first part of the code, before the beginning of the main module (lines 3-27), constants and custom distributions are defined. In particular, it can be seen that the probability for each patient to leave the hospital at the end of each day is set to $0.6$, meaning that the sojourn time of each patient in the hospital is distributed as a geometric distribution. The other two distributions, regarding the patients arrival from emergencies and the drugs consumption, are instead manually defined in the ranges of $[0,4]$ (lines 19-23) and $[0,3]$ (lines 9-12) respectively. Arrivals of scheduled patients for the three subsequent days of lookahead are defined as fixed variables (lines 25-27). Also, cost weights are defined for the order cost of a single drug unit, the cost for urgent drug reorders and the stocking cost for keeping each drug unit in stock in the right conditions.
      
      The main module \prism{hospitalWard} firstly defines several internal variables (lines 30-35), such as the number of hospitalised patients \prism{n}, the number of current drugs in stock \prism{stockDrugs}, the current day \prism{day}, or support variables, such as \prism{s} or \prism{tmp}. In particular \prism{s} will be used to describe the internal state for each day of the ward.
      
      States \prism{s=0,1} (lines 38-45) are used to model the drug order for the current day and for the first and second following days. In particular, lines 38-42 represents all the possible orders that can be issued, modelled through non-deterministic choices. Also, each choice has a label associated, that will be used in the cost reward computation. After the order choice has been made, the \prism{day} variable is incremented and the \prism{tmp} support variable is set to the number of patients currently hospitalised, \prism{n}.
      
      States \prism{s=10,11,12,13} are used to model the arrival and discharge of patients in the ward. State \prism{s=10} (lines 48-49) of the ward is used to cycle through all the currently hospitalised patients to decide which of them will leave the ward, with probability \prism{probExit}. In this scenario the \prism{tmp} variable is used to cycle through all the patients. State \prism{s=11} (lines 52-54) is used to model the arrival of scheduled patients, the exact number of which is indicated by three constants. State \prism{s=12} (lines 57-61) instead is used to model the arrival of new patients through emergencies, employing the custom distribution defined. State \prism{s=13} is then used to move on to the drug consumption phase.
      
      State \prism{s=20} is used to model drug consumption by the currently hospitalised patients. A custom consumption distribution is used and a cycle is implemented through the use of the \prism{tmp} variable as seen for the leaving patients (lines 66-69). On top of that, for each patient, if after the drug consumption some drugs result to be missing (i.e. some drug was needed but there wasn't enough in stock), then the special action with label \prism{missingDrugs} is executed (line 71), which is needed to compute the correct cost reward. When drugs have been administered to all the patients (line 73) the module will then either start again (line 76) or stop definitely (line 77) in case the three following days have been completely modelled.
      
      Lastly, the only reward defined, \prism{totalCost}, is used to cumulate the total cost coming from different sources. In particular, every time the consumption of drug is finished for a certain day, the remaining drugs in stock produce a cost determined by the weight \prism{costStorage}. Each time one or more drugs result missing during administration, and therefore an urgent order has to be issued, each missing drug produce a cost defined by the weight \prism{costUrgentOrder}. Regular orders also produce a cost, in particular a cost of $1$ for each drug ordered.
    }
